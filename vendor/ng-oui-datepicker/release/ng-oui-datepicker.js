/**
 * ng-oui-datepicker - v3.0.2 - 2015-01-12
 *
 * Copyright (c) 2015 Oodrive
 */
!function(a){!function(){function b(a){return new Date(a.getFullYear(),a.getMonth(),a.getDate())}var c,d={en:"en-GB",zh:"zh-CN"},e=null;c={jqui2ng:function(a){return a&&(a=a.replace(/y/g,"yy"),a=a.replace(/M/g,"MM"),a=a.replace(/m/g,"M")),a},ng2jqui:function(a){return a&&(e&&e.DATETIME_FORMATS[a]&&(a=e.DATETIME_FORMATS[a]),a=a.replace(/(^|[^y])y([^y]|$)/g,"$1YY$2"),a=a.replace(/yy/g,"y"),a=a.replace(/YY/g,"yy"),a=/MMMM/.test(a)?a.replace("MMMM","MM"):/MMM/.test(a)?a.replace("MMM","M"):/MM/.test(a)?a.replace("MM","mm"):a.replace("M","mm")),a},ng2js:function(a){return a&&(e&&e.DATETIME_FORMATS[a]&&(a=e.DATETIME_FORMATS[a]),a=a.replace(/M/g,"m"),a=a.replace(/E/g,"d")),a},ng2input:function(a){return a&&(e&&e.DATETIME_FORMATS[a]&&(a=e.DATETIME_FORMATS[a]),a=a.replace(/yyyy/g,"y"),a=a.replace(/yy/g,"y"),a=a.replace(/dd/g,"d"),a=a.replace(/(^|[^M])MM([^M]|$)/g,"$1M$2")),a}},a.module("oui.datepicker",["oui-templates-datepicker","oo.i18n","oui.form.field","dateParser"]).directive("ouiDatepicker",["$i18n","$filter","$locale","$dateParser","$timeout",function(f,g,h,i,j){return e=h,{require:"^?ngModel",restrict:"AE",scope:{name:"@ouiDatepicker",disabled:"=?ngDisabled",readonly:"=?ngReadonly",required:"=?ngRequired",dpNgDateFormat:"@dateFormat",dpNgAltFormat:"@altFormat",defaultDate:"=?",minDate:"=?",maxDate:"=?",boundariesValid:"@",value:"=?ngModel",ooPlaceholder:"@",ooPlaceholderExpr:"&"},replace:!0,templateUrl:"oui-datepicker/datepicker.tpl.html",link:function(e,k,l,m){function n(){m&&m.$setValidity("required",!e.required||!!e.dp.val())}function o(){var a=[],b=null;return b=c.ng2input(e.dpNgDateFormat),-1===a.indexOf(b)&&a.push(b),b=c.ng2input(h.DATETIME_FORMATS.shortDate),-1===a.indexOf(b)&&a.push(b),a}function p(a){var b,c=null;if(a=a?a:e.dp.val(),m&&m.$setValidity("pattern",!0),!a)return e.hidden.val(""),!1;for(t=o(),b=0;b<t.length&&(!c||isNaN(c.getTime()));++b)c=i(a,t[b]);return!c||isNaN(c.getTime())?(m&&m.$setValidity("pattern",!1),!1):c}m&&(m.defaultErrorMsg=a.extend(m.defaultErrors||{},{mindate:"i18n:oui.datepicker.error.mindate",maxdate:"i18n:oui.datepicker.error.maxdate"}));var q,r,s,t=[],u=null,v=null,w=e.dpNgAltFormat||"yyyy-MM-dd";e.getPlaceholder=function(){return e.ooPlaceholder?e.ooPlaceholder:l.ooPlaceholderExpr?e.ooPlaceholderExpr({formats:o()}):o().join(" | ")},e.inputChange=function(){var a=p();a||e.hidden.val(""),e.value=s(e.value),m&&m.$setViewValue(e.value),n()},e.inputBlur=function(){var a=p();a?(a=s(a),e.dp.datepicker("getDate")&&a.getTime()!==e.dp.datepicker("getDate").getTime()?(r(a),e.dp.datepicker("setDate",a),e.value=a,e.hidden.val(g("date")(a,w))):e.value&&e.value.getTime()===a.getTime()||(r(a),e.dp.datepicker("setDate",a),e.value=a,e.hidden.val(g("date")(a,w)))):(e.hidden.val(""),e.value=null),n()},e.minDate&&(u="string"==typeof e.minDate?p(e.minDate):"number"==typeof e.minDate?new Date(e.minDate):e.minDate,u=b(u)),e.maxDate&&(v="string"==typeof e.maxDate?p(e.maxDate):"number"==typeof e.maxDate?new Date(e.maxDate):e.maxDate,v=b(v)),r=function(a){e.boundariesValid&&(a=a&&b(a),m&&m.$setValidity("mindate",!(u&&a&&a.getTime()<u.getTime())),m&&m.$setValidity("maxdate",!(v&&a&&a.getTime()>v.getTime())))},s=function(a){if(!e.boundariesValid){var c=a&&b(a);if(u&&c&&c.getTime()<u.getTime())return new Date(u.getTime());if(v&&c&&c.getTime()>v.getTime())return new Date(v.getTime())}return a},q=e.defaultDate?p(e.defaultDate):new Date,e.$watch(function(){return e.readonly||e.disabled},function(a){a||(e.dp=k.find("input[type=text]"),e.hidden=k.find("input[type=hidden]"),e.dp.datepicker({dateFormat:c.ng2jqui(e.dpNgDateFormat)||$.datepicker.regional[d[f.lang()]||f.lang()].dateFormat,altFormat:c.ng2jqui(w),defaultDate:q,minDate:e.boundariesValid?null:u,maxDate:e.boundariesValid?null:v,altField:e.hidden,onSelect:function(){e.inputChange();var a=e.dp.datepicker("getDate");e.$apply(function(){r(a),e.value=a,m&&m.$setViewValue(e.value)})}}),e.widget=e.dp.datepicker("widget"),j(function(){e.value&&(e.value=s(e.value),r(e.value),e.dp.datepicker("setDate",e.value),e.hidden&&e.hidden.val(g("date")(e.value,w)),n())}))}),e.$watch("value",function(a){a&&(e.value=s(a),e.dp&&(!e.dp.datepicker("getDate")||e.dp.datepicker("getDate")&&a.getTime()!==e.dp.datepicker("getDate").getTime())&&(r(e.value),e.dp.datepicker("setDate",a),e.hidden&&e.hidden.val(g("date")(a,w))))}),e.$on("$langChange",function(a,b){if(e.dp){var f,h=e.value,i=d[b]||b;f=$.datepicker.regional[i],f&&$.each(f,function(a,b){"dateFormat"===a&&e.dpNgDateFormat||e.dp.datepicker("option",a,b)}),e.dp.datepicker("option","dateFormat",c.ng2jqui(e.dpNgDateFormat)||f.dateFormat),e.dp.datepicker("option","altFormat",c.ng2jqui(w)),u&&e.dp.datepicker("option","minDate",u),v&&e.dp.datepicker("option","minDate",v),j(function(){h&&(r(h),e.dp.datepicker("setDate",h),e.hidden&&e.hidden.val(g("date")(h,w)),e.inputBlur())},100)}})}}}]).run(["$i18n","$timeout","$rootScope",function(a,b,c){b(function(){$.datepicker.setDefaults($.datepicker.regional[d[a.lang()]||a.lang()])}),c.$on("$langChange",function(a,b){var c=d[b]||b;$.datepicker.setDefaults($.datepicker.regional[c])})}])}(),function(a){a.module("oui-templates-datepicker",["oui-datepicker/datepicker.tpl.html"]),a.module("oui-datepicker/datepicker.tpl.html",[]).run(["$templateCache",function(a){a.put("oui-datepicker/datepicker.tpl.html",'<div class="oo-form-field-date" ng-class="{\'oo-disabled\':disabled, \'oo-readonly\':readonly}">\n	<div ng-if="!readonly && !disabled">\n		<input type="text" ng-model="displayedValue" ng-blur="inputBlur()"  ng-change="inputChange()" placeholder="{{getPlaceholder()}}"/>\n		<input type="hidden" name="{{name}}"/>\n	</div>\n	<div ng-if="readonly || disabled" class="oo-date oo-text">{{value | date:dpNgDateFormat}}</div>\n</div>')}])}(a)}(angular);